{% extends 'panel/layout/layout.html' %}
{% load static i18n %}

{% block head %}
{% endblock %}

{% block body %}
    {#    {% if user|has_role:"admin_temp" %}#}
    {% include 'panel/inc/sidebar.html' %}
    {#    {% endif %}#}
    <!-- BEGIN: Content-->

    <div class="app-content content">
        <div class="content-overlay"></div>
        <div class="content-wrapper">
            <h1 class="text-center mb-3">{% trans 'Yangi Qabul Yaratish' %}</h1>
            <div class="row breadcrumbs-top">
                <div class="col-12">
                    <div class="heading-elements">
                        <ul class="list-inline mb-0 main-list-heading">
                            <li class="main-searchh">
                                {% comment %} {% if request.GET.q %}
                                            <fieldset class="position-relative">
                                                <form action="" method="GET">
                                                    <input type="text" name="q" class="form-control single-daterange" placeholder="{% trans 'Izlash' %}" value="{{ request.GET.q }}"/>
                                                    <input type="text" name="q" class="form-control single-daterange" placeholder="{% trans 'Izlash' %}" value="rad"/>
                                                    <div class="form-control-position">
                                                        <a href="{% url 'navigation' %}"><i
                                                                class="bx bx-x font-medium-2"></i></a>
                                                    </div>
                                                </form>
                                            </fieldset>
                                        {% else %}
                                            <fieldset class="has-icon-left">
                                                <form action="" method="GET">
                                                    <input type="text" name="q" class="form-control single-daterange" placeholder="{% trans 'Izlash' %}" value="{{ request.GET.q }}"/>
                                                    <input type="text" name="q" class="form-control single-daterange" placeholder="{% trans 'Izlash' %}" value="rad0"/>
                                                    <div class="form-control-position">
                                                        <i class="bx bx-search font-medium-2"></i>
                                                    </div>
                                                </form>

                                            </fieldset>
                                        {% endif %}{% endcomment %}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-md-4">
                <div class="content-body ml-1">
                    <!-- table Transactions start -->
                    <form method="get">{% csrf_token %}
                    <section id="table-transactions">
                        <div class="card">
                            <!-- datatable start -->
                            <div class="table-responsive" style="max-height: 314px;">
                                <table id="table-extended-transactions" class="table mb-0">
                                    <thead>
                                    <tr>
                                        <th class="pl-1"><input id="select-all" class="form-check ajax-murojatchi" type="checkbox"></th>
                                        <th class="text-left pl-0">{% trans 'Mahalla Nomi' %}</th>
                                    </tr>
                                    </thead>
                                    <tbody >
                                    {% for mahalla in mahallalar %}
                                        <tr>
                                            <td class="pl-1"><input type="checkbox" class="ajax-murojatchi" name="{{ mahalla.title }}"></td>
                                            <td class="text-left pl-0">
                                                {{ mahalla.title|safe | truncatechars:"150" }}
                                            </td>

                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </section>
                    <!-- datatable ends -->
                    </form>
                    <!-- table Transactions end -->
                </div>
            </div>
            <div class="col-md-4">
                <div class="content-body ml-1">
                    <!-- table Transactions start -->
                    <form method="GET">
                        {% csrf_token %}
                        <section id="table-transactions">
                            <div class="card">
                                <!-- datatable start -->
                                <div class="table-responsive" style="max-height: 314px;">
                                    <table id="table-extended-transactions" class="table mb-0 ajax-muammo"
                                    data-url="{% url 'panel:murojatchi_filter' %}">
                                        <thead>
                                        <tr>
                                            <th class="pl-1">
                                                <input id="select-all-muammo" class="form-check muammo-filter"
                                                       type="checkbox"  ></th>
                                            <th class="text-left pl-0">{% trans 'Muammo ' %}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for muammo in muammolar %}
                                            <tr>
                                                <td class="pl-1"><input class="form-check muammo-filter" type="checkbox"
                                                                        name="{{ muammo.title }}">
                                                </td>
                                                <td class="text-left pl-0 py-1">
                                                    <ul class="list-unstyled list-inline">
                                                        <li class="list-inline-item">{{ muammo.title|safe | truncatechars:"150" }}</li>
                                                        <li class="list-inline-item"><span
                                                                class="badge badge-info"><strong>{{ muammo.murojatchi_set.count }}</strong></span>
                                                        </li>
                                                    </ul>
                                                </td>

                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </section>
                        <!-- datatable ends -->
                    </form>

                    <!-- table Transactions end -->
                </div>
            </div>
            <div class="col-md-4">
                <div class="content-body ml-1">
                    <!-- table Transactions start -->

                    <section id="table-transactions">
                        <div class="card">
                            <!-- datatable start -->
                            <div class="table-responsive" style="max-height: 314px;">
                                <table id="table-extended-transactions" class="table mb-0 category-contents"
                                       data-url="{% url 'panel:muammo_filter' %}">
                                    <thead>
                                    <tr>
                                        <th class="pl-1"><input id="select-all-category" class="form-check"
                                                                type="checkbox"></th>
                                        <th class="text-left">{% trans 'Kategoriya' %}</th>
                                        <th class="text-left"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </section>
                    <!-- datatable ends -->


                    <!-- table Transactions end -->
                </div>
            </div>
        </div>

            <div class="row" >
                <div class="col-md-12">
                    <div class="content-body">
                        <!-- table Transactions start -->
                        <section id="table-transactions" style="margin-left:17px;margin-right: 30px;">
                            <div class="card">
                                <!-- datatable start -->
                                <div class="table-responsive"  style="max-height: 380px;">
                                    <table id="table-extended-transactions" class="table mb-0 murojatchi-contents">
                                        <thead>
                                        <tr>
                                            <th class="pr-2"><input id="select-all-murojatchi" type="checkbox"></th>
                                            <th class="pl-0">{% trans 'Murojatchi' %}</th>
                                            <th class="text-left">{% trans 'Telefon' %}</th>
                                            <th class="text-left">{% trans 'Murojat Sanasi' %}</th>

                                        </tr>
                                        </thead>
                                        <tbody class ="murojatchi-list">

{#                                            <tr>#}
{#                                                <td class="pr-2"><input type="checkbox"></td>#}
{#                                                <td class="pl-0">#}
{#                                                   Fullname#}
{#                                                </td>#}
{#                                                <td class="text-left">Phone</td>#}
{#                                                <td class="text-left">Created</td>#}
{#                                            </tr>#}

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- datatable ends -->
                        </section>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-11">
                <textarea style="margin-left:20px;margin-right: 30px;" class="form-control" name="" id=""  rows="7" cols="10" required
                          placeholder="{% trans 'Murojatchilarga xat yuboring...' %}"></textarea>
                </div>
                <div class="col-md-1">
            </div>
            <div class="row mt-2">
                <div class="col-md-12 ml-3">
                    <ul class="list-unstyled list-inline">
                        <li class="list-inline-item">
                            <div class="form-check">
                                <input
                                        class="form-check-input"
                                        type="checkbox"
                                        value=""
                                        id="flexCheckDefault"/>
                                <label class="form-check-label" for="flexCheckDefault">
                                    Telegram
                                </label>
                            </div>
                        </li>
                        <li class="list-inline-item">
                            <div class="form-check">
                                <input
                                        class="form-check-input"
                                        type="checkbox"
                                        value=""
                                        id="flexCheckChecked"
                                        checked/>

                                <label class="form-check-label mr-2" for="flexCheckChecked">
                                    SMS
                                </label>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <button class="btn btn-info" style="margin: 8px;" type="submit">{% trans 'Yuborish' %}</button>
            <!-- table Transactions end -->



        <!-- END: Content-->

        <div class="sidenav-overlay"></div>
        <div class="drag-target"></div>

    </div>
{% endblock %}
</div>

{% block js %}
    <script>
        $('#select-all').click(function (e) {
            var table = $(e.target).closest('table');
            $('td input:checkbox', table).prop('checked', this.checked);
        });

        $('#select-all-muammo').click(function (e) {
            var table = $(e.target).closest('table');
            $('td input:checkbox', table).prop('checked', this.checked);
        });
        $('#select-all-category').click(function (e) {
            var table = $(e.target).closest('table');
            $('td input:checkbox', table).prop('checked', this.checked);
        });
        $('#select-all-murojatchi').click(function (e) {
            var table = $(e.target).closest('table');
            $('td input:checkbox', table).prop('checked', this.checked);
        });


    </script>

    <script>
     $(document).ready(function (e) {

            $('.ajax-murojatchi').click(function () {
                let choices = {}

                $('.murojatchi-list').empty();

                $('input[type=checkbox]:checked').each(function () {

                    choices[this.name] = this.value
                });
                    console.log(choices)
            $.ajax({
                    type: 'GET',
                    url: "{% url 'panel:ajax_mahalla' %}",
                    headers: {
                        'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    dataType: 'json',
                    cache: false,
                    data: {
                        choices: choices,
                    },

                    success: function(data) {
                        $('.murojatchi-contents').find('tbody').empty()
                        JSON.parse(data.query).forEach(function (d) {
                            $('.murojatchi-contents').find('tbody').append('<tr>' +
                                '<td><input type="checkbox"></td>' +
                                '<td class="text-left">' + d.fields.fullname + '</td>' +
                                '<td class="text-left">' + d.fields.phone + '</td>' +
                                '<td class="text-left">' + d.fields.created + '</td>' +
                                '</tr>')
                        })
aw

                             {#$('.murojatchi-contents').find('tbody').append(' <tr class = "kategory_list"><td class="pl-1"><input type="checkbox"></td>' +#}
                             {#    '<td class="text-left ajax-category" >' +#}
                             {#    'key' +#}
                             {#    '</td>' +#}
                             {#    '<td class="text-left"><span' +#}
                             {#    'class="badge badge-info"><strong>' + 'value' + '</strong></span></td></tr>');#}


                    },
                    error: function (err) {
                        console.log(err);
                        console.log(choices);
                    }
                });
            })
        });
    </script>

    <script>
        $(document).ready(function (e) {

            $('.ajax-muammo .muammo-filter').click(function () {
                let choices = {}

                $('.category-list').empty();

                $('input[type=checkbox]:checked').each(function () {

                    choices[this.name] = this.value
                });





            $.ajax({
                    type: 'GET',
                    url: "{% url 'panel:muammo_filter' %}",
                    headers: {
                        'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val(),

                    },
                    dataType: 'json',
                    cache: false,
                    data: {
                        choices: choices,
                    },


                    success: function(data) {
                        $('.category-contents').find('tbody').empty()

                         Object.entries(data.query).forEach((entry) => {
                             const [key, value] = entry;

                             $('.category-contents').find('tbody').append(' <tr class = "kategory_list"><td class="pl-1"><input type="checkbox"></td>' +
                                 '<td class="text-left ajax-category" >' +
                                 key +
                                 '</td>' +
                                 '<td class="text-left"><span' +
                                 'class="badge badge-info"><strong>' + value + '</strong></span></td></tr>');
                         });

                    },
                    error: function (err) {
                        console.log(err);
                        console.log(choices);
                    }
                });


            })


        });
    </script>
{% endblock %}

